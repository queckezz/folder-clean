# folder-clean

[![npm version][version-image]][version-url]
[![build status][travis-image]][travis-url]
[![dependency status][david-image]][david-url]
[![license][license-image]][license-url]
[![js standard style][standard-image]][standard-url]
[![downloads per month][downloads-image]][downloads-url]

> Deletes all files in a folder which are older than a given date. It returns a detailed report of which files have been **kept**, **deleted** or were **busy**.

## Example

```js
const { clean } = require('folder-clean')
const { join } = require('path')

const config = {
  maxAge: 180,
  recursive: true,
  deleteEmptyFolders: true
}

clean(join(process.cwd(), 'logs'), config)
	.then((report) => {
      console.log('cleaned!')
	})
```

Where `report` returns something like the following:

```js
{
    delete: [{
        itemType: Symbol(FILE),
        actionType: Symbol(DELETE),
        path: '~/absolute/path/recursive/index-old.txt'
    }, {
        itemType: Symbol(FILE),
        actionType: Symbol(DELETE),
        path: '~/absolute/path/recursive/sub-folder/index-old.txt'
    }],
    retain: [{
        itemType: Symbol(FILE),
        actionType: Symbol(RETAIN),
        path: '~/absolute/path/recursive/index.txt'
    }, {
        itemType: Symbol(FILE),
        actionType: Symbol(RETAIN),
        path: '~/absolute/path/recursive/sub-folder/index.txt'
    }, {
        itemType: Symbol(DIR),
        actionType: Symbol(RETAIN),
        path: '~/absolute/path/recursive/sub-folder'
    }]
}
```

## Installation

    > npm install folder-clean

(or)

    > yarn add folder-clean

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### clean

Deletes all files in a folder which are older than a given date. It returns
a detailed report of which files have been **kept** or **deleted**. You can
recursively delete and decide if you want to keep empty folders.

**Parameters**

-   `path` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Absolute path
-   `config` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?** 
    -   `config.recursive` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** Whether to go through all sub folders or not (optional, default `false`)
    -   `config.deleteEmptyFolders` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** Whether to delete empty sub folders or not (optional, default `false`)
    -   `config.maxAge` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Max age which determines how long a file will be kept until deleting it (optional, default `90`)
-   `_config`  

**Examples**

```javascript
clean('~/some/folder', { recursive: true })
  .then((actions) => {
    // ~/some/folder cleaned
  })
```

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Set of actions which have been executed

### getFolderActions

Returns an array of actions of how the folder should be cleaned. This just
creates a report and does not delete anything. Each directory item in the
array can have another set of actions.

**Parameters**

-   `path` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Absolute path
-   `config` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?** 
    -   `config.recursive` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** Whether to go through all sub folders or not (optional, default `false`)
    -   `config.deleteEmptyFolders` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** Whether to delete empty sub folders or not (optional, default `false`)
    -   `config.maxAge` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?** Max age which determines how long a file will be kept until deleting it (optional, default `90`)
-   `deleteAt` **[Date](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date)** Date of when the deletion should happen (can be in the past of course)
-   `$1` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$1.deleteAt`  
    -   `$1.maxAge`  
    -   `$1.recursive`  
    -   `$1.deleteEmptyFolders`  

**Examples**

```javascript
const actions = await getFolderActions('~/some/folder', {
  deleteAt: new Date('11/14/2016'),
  recursive: false,
  maxAge: 90
})
```

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** actions - Actions to be executed by `executeActions`

### executeActions

Executes each action at filesystem level.

**Parameters**

-   `actions` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** Tree-like action set, most likely from `getFolderActions`

**Examples**

```javascript
await executeActions(await getFolderActions('~/some/folder', options))
```

Returns **[undefined](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined)** 

### sortByType

Creates an object from an array of actions, sorted by their action type.

**Parameters**

-   `actions` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** An array of actions

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** actions

### flattenActions

Flattens each directory in an array of actions down to one level. You'll get
an array of actions which includes each **sub action** from any directory and
the action for the directory itself.

**Parameters**

-   `actions` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** An array of actions

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)** flattenedActions

## License

[MIT][license-url]

[travis-image]: https://img.shields.io/travis/queckezz/folder-clean.svg?style=flat-square

[travis-url]: https://travis-ci.org/queckezz/folder-clean

[version-image]: https://img.shields.io/npm/v/folder-clean.svg?style=flat-square

[version-url]: https://npmjs.org/package/folder-clean

[downloads-image]: https://img.shields.io/npm/dm/folder-clean.svg?style=flat-square

[downloads-url]: https://npmjs.org/package/folder-clean

[david-image]: http://img.shields.io/david/queckezz/folder-clean.svg?style=flat-square

[david-url]: https://david-dm.org/queckezz/folder-clean

[standard-image]: https://img.shields.io/badge/code-standard-brightgreen.svg?style=flat-square

[standard-url]: https://github.com/feross/standard

[license-image]: http://img.shields.io/npm/l/folder-clean.svg?style=flat-square

[license-url]: ./license
